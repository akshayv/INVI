import json
from business.graph.parser.GraphParser import GraphParser
from integration.http.map.MapRetriever import MapRetriever

__author__ = 'akshay'


class GraphCache(object):

    __graphCache = {}
    __instance = None

    def __new__(cls, *args, **kwargs):
        if not cls.__instance:
            cls.__instance = super(GraphCache, cls).__new__(
                cls, *args, **kwargs)
        return cls.__instance

    def __init__(self):
        com1level2 = GraphParser.parseGraph(json.loads('{"info":{"northAt":"315"},"map":[{"nodeId":"1","x":"0","y":"2436","nodeName":"TO LT15","linkTo":"2 "},{"nodeId":"2","x":"2152","y":"2436","nodeName":"P2","linkTo":"1, 3, 4  "},{"nodeId":"3","x":"2152","y":"731","nodeName":"Linkway","linkTo":"2"},{"nodeId":"4","x":"2883","y":"2436","nodeName":"P4","linkTo":"2, 5, 6, 7"},{"nodeId":"5","x":"2883","y":"1787","nodeName":"P5","linkTo":"4, 8 "},{"nodeId":"6","x":"2883","y":"2924","nodeName":"Seminar Room 6","linkTo":"4"},{"nodeId":"7","x":"3776","y":"2436","nodeName":"Lobby ","linkTo":"4, 10"},{"nodeId":"8","x":"3330","y":"1787","nodeName":"P8","linkTo":"5, 9, 10 "},{"nodeId":"9","x":"3330","y":"934","nodeName":"Seminar Room 2","linkTo":"8"},{"nodeId":"10","x":"3776","y":"1787","nodeName":"P10","linkTo":"7, 8, 11"},{"nodeId":"11","x":"5603","y":"1787","nodeName":"Student Area","linkTo":"10, 12, 13, 14"},{"nodeId":"12","x":"5603","y":"2924","nodeName":"Seminar Room 1","linkTo":"11"},{"nodeId":"13","x":"5603","y":"609","nodeName":"P13","linkTo":"11, 36"},{"nodeId":"14","x":"7065","y":"1787","nodeName":"P14","linkTo":"11, 15, 37 "},{"nodeId":"15","x":"7065","y":"2802","nodeName":"P15","linkTo":"14, 32 "},{"nodeId":"16","x":"7065","y":"731","nodeName":"P16","linkTo":"18, 37"},{"nodeId":"17","x":"9014","y":"2802","nodeName":"P17","linkTo":"39, 19, 21 "},{"nodeId":"18","x":"8283","y":"731","nodeName":"P18","linkTo":"16, 20, 22"},{"nodeId":"19","x":"9014","y":"2193","nodeName":"Executive Classroom","linkTo":"17"},{"nodeId":"20","x":"8283","y":"1056","nodeName":"Tutorial Room 11","linkTo":"18"},{"nodeId":"21","x":"9460","y":"2802","nodeName":"P21","linkTo":"17, 23, 24 "},{"nodeId":"22","x":"9744","y":"731","nodeName":"P22","linkTo":"18, 25, 34"},{"nodeId":"23","x":"9460","y":"3248","nodeName":"Seminar Room 9","linkTo":"21"},{"nodeId":"24","x":"11003","y":"2802","nodeName":"P24","linkTo":"21, 27, 28"},{"nodeId":"25","x":"9744","y":"1056","nodeName":"NUS Hacker\'s Room","linkTo":"22"},{"nodeId":"26","x":"11003","y":"691","nodeName":"P26","linkTo":"34, 28, 29 "},{"nodeId":"27","x":"11003","y":"3248","nodeName":"Seminar Room 11","linkTo":"24 "},{"nodeId":"28","x":"11003","y":"1259","nodeName":"P28","linkTo":"24, 26, 30"},{"nodeId":"29","x":"11571","y":"691","nodeName":"P29","linkTo":"26, 31 "},{"nodeId":"30","x":"12180","y":"731","nodeName":"TO Canteen","linkTo":"28  "},{"nodeId":"31","x":"11815","y":"406","nodeName":"TO 2-2-1","linkTo":"29 "},{"nodeId":"32","x":"7552","y":"2802","nodeName":"P32","linkTo":"15, 33, 39 "},{"nodeId":"33","x":"7552","y":"3086","nodeName":"Seminar Room 7","linkTo":"32"},{"nodeId":"34","x":"10272","y":"731","nodeName":"P34","linkTo":"22, 26, 35 "},{"nodeId":"35","x":"10272","y":"447","nodeName":"Tutorial Room 5","linkTo":"34 "},{"nodeId":"36","x":"4263","y":"609","nodeName":"Cerebro","linkTo":"13"},{"nodeId":"37","x":"7065","y":"1543","nodeName":"P37","linkTo":"14, 16, 38 "},{"nodeId":"38","x":"7552","y":"1543","nodeName":"SR3 Front","linkTo":"37"},{"nodeId":"39","x":"8811","y":"2802","nodeName":"P39","linkTo":"17, 32, 40 "},{"nodeId":"40","x":"8811","y":"2436","nodeName":"SR3 Back","linkTo":"39"}],"wifi":[{"nodeId":"1","x":"569","y":"2599","nodeName":"arc-0201-a","macAddr":"e8:ba:70:61:c9:60"},{"nodeId":"2","x":"2274","y":"2599","nodeName":"arc-0202-a","macAddr":"e8:ba:70:61:af:20"},{"nodeId":"3","x":"2964","y":"731","nodeName":"arc-0204-a","macAddr":"04:da:d2:74:cf:30"},{"nodeId":"4","x":"5400","y":"934","nodeName":"arc-0205-a","macAddr":"e8:ba:70:52:3b:e0"},{"nodeId":"5","x":"4060","y":"609","nodeName":"arc-0205-b","macAddr":"e8:ba:70:52:bf:80"},{"nodeId":"6","x":"4263","y":"2315","nodeName":"arc-0206-a","macAddr":"e8:ba:70:52:0b:40"},{"nodeId":"7","x":"6578","y":"2924","nodeName":"arc-0206-b","macAddr":"e8:ba:70:52:1e:90"},{"nodeId":"8","x":"8445","y":"2842","nodeName":"arc-0212-a","macAddr":"e8:ba:70:52:ab:e0"},{"nodeId":"9","x":"10435","y":"2964","nodeName":"arc-0210-a","macAddr":"e8:ba:70:61:b3:50"},{"nodeId":"10","x":"7796","y":"1706","nodeName":"arc-0212-b","macAddr":"50:06:04:8d:d0:10"},{"nodeId":"11","x":"8608","y":"1868","nodeName":"arc-0213-a","macAddr":"04:da:d2:74:c8:70"},{"nodeId":"12","x":"10800","y":"1097","nodeName":"arc-0214-a","macAddr":"e8:ba:70:52:bd:80"},{"nodeId":"13","x":"9866","y":"731","nodeName":"arc-0239-a","macAddr":"e8:ba:70:61:a8:80"},{"nodeId":"14","x":"6902","y":"934","nodeName":"arc-0241-a","macAddr":"28:93:fe:d3:8b:20"}]}'))
        com2level2 = GraphParser.parseGraph(json.loads('{"info":{"northAt":"305"},"map":[{"nodeId":"1","x":"61","y":"4024","nodeName":"TO 1-2-31","linkTo":"17"},{"nodeId":"2","x":"1585","y":"2561","nodeName":"P2","linkTo":"3, 5, 17"},{"nodeId":"3","x":"1342","y":"2378","nodeName":"Uncle Soo\'s Office","linkTo":"2"},{"nodeId":"4","x":"2134","y":"2317","nodeName":"Colin\'s Office","linkTo":"5"},{"nodeId":"5","x":"1951","y":"2195","nodeName":"P5","linkTo":"2, 4, 19"},{"nodeId":"6","x":"2988","y":"1098","nodeName":"P6","linkTo":"7, 11, 19"},{"nodeId":"7","x":"3353","y":"732","nodeName":"P7","linkTo":"6, 8"},{"nodeId":"8","x":"4085","y":"732","nodeName":"P8","linkTo":"7, 9, 10"},{"nodeId":"9","x":"4085","y":"976","nodeName":"Discussion Room 6","linkTo":"8"},{"nodeId":"10","x":"8047","y":"732","nodeName":"End of Corridor","linkTo":"8"},{"nodeId":"11","x":"3475","y":"1646","nodeName":"Glass Door","linkTo":"6, 12"},{"nodeId":"12","x":"3780","y":"1829","nodeName":"Wooden Door","linkTo":"11, 13"},{"nodeId":"13","x":"4146","y":"2012","nodeName":"Another Door","linkTo":"12, 14"},{"nodeId":"14","x":"4329","y":"2317","nodeName":"Stairwell","linkTo":"13, 15"},{"nodeId":"15","x":"3841","y":"2744","nodeName":"Halfway","linkTo":"14, 16"},{"nodeId":"16","x":"3719","y":"2622","nodeName":"TO 2-3-11","linkTo":"15"},{"nodeId":"17","x":"1159","y":"2927","nodeName":"P17","linkTo":"1, 2, 18"},{"nodeId":"18","x":"915","y":"2805","nodeName":"Bimlesh\'s Office","linkTo":"17"},{"nodeId":"19","x":"2622","y":"1464","nodeName":"P19","linkTo":"5, 6, 20 "},{"nodeId":"20","x":"2378","y":"1342","nodeName":"Damith\'s Office","linkTo":"19"}],"wifi":[{"nodeId":"1","x":"366","y":"3658","nodeName":"arc-0215-a","macAddr":"e8:ba:70:61:b6:50"},{"nodeId":"2","x":"1464","y":"2683","nodeName":"arc2-0261-a","macAddr":"50:06:04:8d:ac:c0"},{"nodeId":"3","x":"2500","y":"1585","nodeName":"arc-0229-a","macAddr":"e8:ba:70:61:a8:f0"},{"nodeId":"4","x":"3841","y":"732","nodeName":"arc2-0254-a","macAddr":"e8:ba:70:52:3e:80"},{"nodeId":"5","x":"5548","y":"671","nodeName":"arc2-0250-a","macAddr":"e8:ba:70:61:ad:b0"},{"nodeId":"6","x":"7681","y":"671","nodeName":"arc2-0243-a","macAddr":"e8:ba:70:52:53:10"}]}'))
        com2level3 = GraphParser.parseGraph(json.loads('{"info":{"northAt":"305"},"map":[{"nodeId":"1","x":"61","y":"4024","nodeName":"TO 1-3-18","linkTo":"16"},{"nodeId":"2","x":"2988","y":"1098","nodeName":"P2","linkTo":"3, 7, 14 "},{"nodeId":"3","x":"3353","y":"732","nodeName":"P3","linkTo":"2, 4  "},{"nodeId":"4","x":"3902","y":"732","nodeName":"P4","linkTo":"3, 5, 12 "},{"nodeId":"5","x":"3902","y":"976","nodeName":"Discussion Room 7","linkTo":"4"},{"nodeId":"6","x":"8047","y":"732","nodeName":"End of Corridor","linkTo":"12"},{"nodeId":"7","x":"3475","y":"1646","nodeName":"Glass Door","linkTo":"2, 8"},{"nodeId":"8","x":"3780","y":"1829","nodeName":"Wooden Door","linkTo":"7, 9"},{"nodeId":"9","x":"4146","y":"2012","nodeName":"Another Door","linkTo":"8, 10"},{"nodeId":"10","x":"4207","y":"2134","nodeName":"Stairwell","linkTo":"9, 11"},{"nodeId":"11","x":"3719","y":"2622","nodeName":"TO 2-2-16","linkTo":"10"},{"nodeId":"12","x":"4085","y":"732","nodeName":"P12","linkTo":"4, 6, 13"},{"nodeId":"13","x":"4085","y":"976","nodeName":"Discussion Room 8","linkTo":"12"},{"nodeId":"14","x":"2134","y":"1951","nodeName":"P14","linkTo":"2, 15, 16 "},{"nodeId":"15","x":"2317","y":"2012","nodeName":"Henry\'s Room","linkTo":"14"},{"nodeId":"16","x":"1524","y":"2500","nodeName":"Mysterious Pt","linkTo":"1, 14"}],"wifi":[{"nodeId":"1","x":"1037","y":"2988","nodeName":"arc-0334-a","macAddr":"e8:ba:70:52:51:70"},{"nodeId":"2","x":"2195","y":"1829","nodeName":"arc-0324-a","macAddr":"e8:ba:70:61:b1:60"},{"nodeId":"3","x":"3719","y":"732","nodeName":"arc2-0348-a","macAddr":"28:93:fe:c8:a8:e0"},{"nodeId":"4","x":"5487","y":"671","nodeName":"arc2-0318-a","macAddr":"70:10:5c:7d:39:b0"},{"nodeId":"5","x":"7255","y":"732","nodeName":"arc2-0339-a","macAddr":"e8:ba:70:52:bf:b0"},{"nodeId":"6","x":"9205","y":"732","nodeName":"arc2-0332-a","macAddr":"e8:ba:70:52:c5:20"}]}'))
        self.__graphCache["1-L2"] = com1level2
        self.__graphCache["2-L2"] = com2level2
        self.__graphCache["2-L3"] = com2level3
        self.__graphCache["COM1-L2"] = com1level2
        self.__graphCache["COM2-L2"] = com2level2
        self.__graphCache["COM2-L3"] = com2level3

    def getGraph(self, building, level):
        key = building + "-L" + level
        if not key in GraphCache.__graphCache:
            graph = GraphParser.parseGraph(MapRetriever.retrieveData(building, level), building, level)
            GraphCache.__graphCache[key] = graph
        return GraphCache.__graphCache.get(building + "-L" + level)
